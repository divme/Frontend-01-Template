<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>path</title>
	<style>
		#container {
      display: flex;
			flex-wrap: wrap;
			width: 1000px;
			height: 1000px;
		}
		.cell {
			width: 8px;
			height: 8px;
			margin: 1px;
			background: #f2f2f2;
			box-sizing: border-box;
		}
	</style>
</head>
<body>
<div id="container"></div>

<button onclick="localStorage.map = JSON.stringify(map)">保存</button>
<script>
	class BinaryHeap {
	  constructor() {

	  }
	  take() {

	  }
	  insertAt(i, v) {

	  }
	}

	class Sorted {
	  constructor(data, compare) {
	    this.data = data;
	    this.compare = compare
	  }
	  take() {
      if (!this.data.length)
        return;
      let min = this.data[0];
      let minIndex = 0;
      for (let i = 0, len = this.data.length; i < len; i++) {
        if (this.compare(this.data[i], min) < 0) {
          min = this.data[i];
          minIndex = i;
        }
      }
      this.data[minIndex] = this.data[this.data.length - 1];
      this.data.pop()
		  return min;
	  }
	  insert(n) {
	    this.data.push(n)
	  }
	  get length() {
	    return this.data.length
	  }
	}
	// 地图表盘
	// true false
	// 可视化
	//
	var map = localStorage.getItem('map') ? JSON.parse(localStorage.getItem('map')) : new Array(10000).fill(0);
	var container = document.getElementById('container');
	var frag = document.createDocumentFragment();
	for (let y = 0; y < 100; y++) {
	  for (let x = 0; x < 100; x++) {
	    let cell = document.createElement('div');
	    cell.classList.add('cell');
	    if (map[100 * y + x] === 1) {
	      cell.style.background = 'black'
	    }
	    frag.appendChild(cell);
	    cell.addEventListener('mousemove', () => {
	      if (mouse) {
          cell.style.background = 'black';
          map[100 * y + x] = 1;
	      }
	    })
	  }
	}
	container.appendChild(frag);

	let mouse = false;
	document.addEventListener('mousedown', () => mouse = true);
	document.addEventListener('mouseup', () => {
	  mouse = false
  });

	document.addEventListener('contentmenu', e => e.preventDefault())

  function sleep(delay) {
    return new Promise((resolve) => {
      setTimeout(resolve, delay);
    })
  }

	async function path(map, start, end) {
	  map = map.slice()
	  let queue = [start]

		async function insert([x, y], pre) {
	    if (map[100 * y + x] !== 0)
	      return;
	    if (queue[100 * y + x])
	      return;
	    if (x < 0 || y < 0 || x >= 100 || y >= 100)
	      return;
	    map[100 * y + x] = pre;
	    container.children[100 * y + x].style.background = 'lightgreen';
			await sleep(5);
	    queue.push([x, y]);
		}

		while(queue.length) {
	    let [x, y] = queue.shift();  // pop unshift | push shift

			if (x === end[0] && y === end[1]) { // end condition
			  let path = [];
			  while (x !== start[0] || y !== end[1]) {
			    path.push([x, y])
          container.children[100 * y + x].style.background = 'pink';
				  [x, y] = map[100 * y + x]
			  }
			  return path;
			}
			// 左  下 右 上
      await insert([x - 1, y], [x, y]);
      await insert([x, y - 1], [x, y]);
      await insert([x + 1, y], [x, y]);
      await insert([x, y + 1], [x, y]);

			// 左  右  下  上
      // await insert([x - 1, y], [x, y]);
      // await insert([x + 1, y], [x, y]);
      // await insert([x, y - 1], [x, y]);
      // await insert([x, y + 1], [x, y]);

      // 左下 右下 左上 右上
      // await insert([x - 1, y - 1], [x, y]);
      // await insert([x + 1, y - 1], [x, y]);
      // await insert([x - 1, y + 1], [x, y]);
      // await insert([x + 1, y + 1], [x, y]);
		}
		return null;
	}
	// 广搜能找到最优路径，queue
	// 深搜很傻呼呼，stack
</script>
</body>
</html>
